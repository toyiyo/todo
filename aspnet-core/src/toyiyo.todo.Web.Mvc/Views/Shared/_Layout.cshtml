<!-- Add these in the head section -->

<head>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
</head>

<!-- Add these just before the closing body tag, after jQuery but before your application scripts -->

<body>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"
        integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
    <script src="~/lib/abp-web-resources/Abp/Framework/scripts/libs/abp.signalr-client.js"></script>
    @RenderSection("scripts", required: false)
    <script>
        // Initialize notification handlers
        abp.event.on('abp.notifications.received', function (userNotification) {
            console.log('Notification received:', userNotification);
            abp.notifications.showUiNotifyForUserNotification(userNotification);
            playNotificationSound();
        });

        // Update notification formatters
        abp.notifications.messageFormatters['Abp.Notifications.LocalizableMessageNotificationData'] = function (userNotification) {
            return abp.localization.localize(
                userNotification.notification.data.message.name,
                userNotification.notification.data.message.sourceName
            );
        };

        // Update notification formatters with correct data structure handling
        abp.notifications.messageFormatters['toyiyo.todo.Notifications.NotificationData.NoteMentionNotificationData'] = function (userNotification) {
            console.log('Formatting mention notification:', userNotification);
            var data = userNotification.notification.data;
            
            // Extract message from properties
            var message = data.properties ? data.properties.Message : 'No message';
            
            return message || 'You have been mentioned in a note';
        };

        // Fallback formatter
        abp.notifications.messageFormatters['default'] = function (userNotification) {
            console.log('Using default formatter for:', userNotification);
            var data = userNotification.notification.data;
            
            if (data.properties && data.properties.Message) {
                return data.properties.Message;
            }
            
            return userNotification.notification.notificationName || 'New notification';
        };

        function playNotificationSound() {
            var audio = new Audio('/sounds/notification.mp3');
            audio.play().catch(function(error) {
                console.log('Error playing notification sound:', error);
            });
        }
    </script>
</body>

</html>
